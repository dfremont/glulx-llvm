image:
  - Visual Studio 2019
  - Ubuntu
  - macOS

environment:
  APPVEYOR_SAVE_CACHE_ON_ERROR: true
  SCCACHE_CACHE_SIZE: 1G
  SCCACHE_DIR: %APPVEYOR_BUILD_FOLDER%/build-cache

cache:
  - 'build-cache'

install:
  - git submodule update --init --recursive --depth 1

for:
-
  matrix:
    only:
      - image: Visual Studio 2019
  init:
    - choco install sccache
-
  matrix:
    only:
      - Ubuntu
  init:
    - appveyor DownloadFile https://github.com/mozilla/sccache/releases/download/v0.2.15/sccache-dist-v0.2.15-x86_64-unknown-linux-musl.tar.gz
    - tar xzf sccache-dist-v0.2.15-x86_64-unknown-linux-musl.tar.gz
    - mv sccache-v0.2.15-x86_64-unknown-linux-musl sccache
    - export PATH=$PATH:`pwd`/sccache
-
  matrix:
    only:
      - image: macOS
  init:
    - brew install ninja
    - brew install sccache

build_script:
  - mkdir llvm-build
  - cd llvm-build
  - cmake -G "Ninja" -DCMAKE_BUILD_TYPE=Release -DCMAKE_C_COMPILER_LAUNCHER=sccache -DCMAKE_CXX_COMPILER_LAUNCHER=sccache -DLLVM_ENABLE_PROJECTS="clang" -DLLVM_TARGETS_TO_BUILD="Glulx" ../llvm-project/llvm
  - ninja

on_success:
  - sccache -s
